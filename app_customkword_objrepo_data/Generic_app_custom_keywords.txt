*** Keywords ***
Swipe_until_element
    [Arguments]    ${findElement}
    : FOR    ${licznik}    IN RANGE    0    10
    \    Swipe    600    600    100    600
    \    ${elementXNew}    Select_carousel    ${findElement}
    \    Run Keyword If    39.0 < ${elementXNew} < 233.0    Run Keywords    Log    "Yeah"
    \    ...    AND    Exit For Loop
    \    ${licznik}    Set Variable    ${licznik}+1

Select_carousel
    [Arguments]    ${findElement}
    ${bound}    Get Element Location    //android.view.View[@text="${findElement}"]
    ${boundString}    Convert To String    ${bound}
    ${elementsXY}    Split String    ${boundString}    ${SPACE}
    #location format, e.g. ${elementsXY} = [u"{'y':", u'702.0,', u"'x':", u'718.0}']
    ${elementX}    Get From List    ${elementsXY}    3
    ${finalelementX}    Strip String    ${elementX}    characters=}
    [Return]    ${finalelementX}

Open app
    Open Application    ${appiumServer}    platformName=${platformName}    platformVersion=${androidVersion}    deviceName=${deviceName}    appPackage=${appPackage}    appActivity=${appActivity}
    ...    noReset=true

User_input
    [Arguments]    ${input_text}
    Click Element    //*[@content-desc="Keyboard menu"]
    Wait Until Element is Visible    ${textbox_obj}    5    None
    Input Text    ${textbox_obj}    ${input_text}
    Click Element    ${sendkey_obj}
    Sleep    2s
    Click Element    //*[@content-desc="Keyboard menu"]
    #Click Element    //*[@text="CEK INFONYA!"]
    #Sleep    2s
    #Click Element    //*[@text="CEK INFONYA!"]
    Sleep    5s

Check_VA_response_text
    [Arguments]    ${response_text}
    #Click Element    id=jp.naver.line.android:id/chatlog
    Wait Until Keyword Succeeds    15s    3s    Page Should Contain Element    //android.widget.TextView[contains(@text,'${response_text}')]

Check_VA_response_text_2buttons
    [Arguments]    ${response_text}    ${button1}    ${button2}
    #Click Element    id=jp.naver.line.android:id/chatlog
    Wait Until Keyword Succeeds    15s    3s    Page Should Contain Element    //android.view.View[contains(@text,'${response_text}')]
    Wait Until Keyword Succeeds    10s    2s    Page Should Contain Element    //android.view.View[contains(@text,'${button1}')]
    Wait Until Keyword Succeeds    10s    2s    Page Should Contain Element    //android.view.View[contains(@text,'${button2}')]

Click_Yes
    ${totalYa}    Get Matching Xpath Count    ${Ya_button}
    Click Element    ${Ya_button}[${totalYa}]

Click_No
    ${totalNo}    Get Matching Xpath Count    ${Tidak_button}
    Click Element    ${Tidak_button}[${totalNo}]

Cancel_and_closing_session
    User_input    ${cancel_answer}
    Check_VA_response_text    ${VA_cancel}
    Check_VA_response_text    ${VA_question_1}
    User_input    ${no_answer}
    Check_VA_response_text    ${VA_question_2}
    User_input    ${user_rate}
    Capture Page Screenshot    user_rate.png
    Check_VA_response_text    ${VA_question_3}
    #only type in at the moment
    User_input    ${select_Rate}
    Check_VA_response_text    ${VA_askRateReason}
    User_input    ${no_answer}
    Check_VA_response_text    ${VA_closingstatement}

Closing_session
    User_input    ${no_answer}
    Check_VA_response_text    ${VA_question_2}
    User_input    ${user_rate}
    Capture Page Screenshot    user_rate.png
    Check_VA_response_text    ${VA_question_3}
    #only type in at the moment
    User_input    ${select_Rate}
    Check_VA_response_text    ${VA_askRateReason}
    User_input    ${no_answer}
    Check_VA_response_text    ${VA_closingstatement}

Check_VA_response_carousel_exists
    Wait Until Keyword Succeeds    15s    3s    Element Should Be Visible    //android.webkit.WebView

Swipe_up_until_element
    [Arguments]    ${user_input}
    #${count_user_input}    Run Keyword And Return Status    Element Should Be Visible    //*[@resource-id="jp.naver.line.android:id/message_text" and contains (@text, "${user_input}")]
    : FOR    ${loop}    IN RANGE    0    10
    \    Swipe    600    600    600    800
    \    ${count_user_input}    Run Keyword And Return Status    Wait Until Element Is Visible    //*[@resource-id="jp.naver.line.android:id/message_text" and contains (@text, "${user_input}")]
    \    Run Keyword If    ${count_user_input}    Run Keywords    Log    "Yeah"
    \    ...    AND    Capture Page Screenshot    here.png
    \    ...    AND    Exit For Loop
    #Scroll Up    //*[@resource-id="jp.naver.line.android:id/message_text" and contains (@text, "${user_input}")]

Find_YLocation
    [Arguments]    ${element}
    ${bound}    Get Element Location    ${element}
    ${boundString}    Convert To String    ${bound}
    ${elementsXY}    Split String    ${boundString}    ${SPACE}
    #location format, e.g. ${elementsXY} = [u"{'y':", u'702.0,', u"'x':", u'718.0}']
    ${elementY}    Get From List    ${elementsXY}    1
    ${finalelementY}    Strip String    ${elementY}    characters=,
    [Return]    ${finalelementY}

Count_messages
    [Arguments]    ${user_input}
    @{list_response}=    Create List
    ${count_user_input}    Run Keyword And Return Status    Wait Until Element Is Visible    //*[@resource-id="jp.naver.line.android:id/message_text" and contains (@text, "${user_input}")]
    Run Keyword If    ${count_user_input}==${FALSE}    Swipe_up_until_element    ${user_input}
    ${count_tsel_icon}    Get Matching Xpath Count    //android.widget.ImageView[@resource-id="jp.naver.line.android:id/chathistory_row_thumbnail"]
    #@{tsel_icon_webelements}    Get Webelements    //*[@resource-id="jp.naver.line.android:id/chathistory_row_thumbnail"]
    ${count_message1}    Get Matching Xpath Count    //android.widget.ListView[1]/android.widget.LinearLayout    #//android.widget.RelativeLayout[3]/android.widget.LinearLayout[1]/android.widget.FrameLayout[1]/android.widget.ListView[1]/android.widget.LinearLayout
    ${count_message2}    Get Matching Xpath Count    //*[@resource-id="jp.naver.line.android:id/chathistory_row_message_layout"]
    ${count_texts}    Get Matching Xpath Count    //*[@resource-id="jp.naver.line.android:id/message_text"]
    ${user_finalelementY}    Find_YLocation    //*[@resource-id="jp.naver.line.android:id/message_text" and contains (@text, "${user_input}")]
    Log Source
    #: FOR    ${item}    IN    @{tsel_icon_webelements}
    #\    ${VAresp_finalelementY}    Find_YLocation    ${item}
    #\    Run Keyword If    ${VAresp_finalelementY}>${user_finalelementY}    Append To List    ${list_response}    ${item}
    : FOR    ${looping}    IN RANGE    1    ${count_tsel_icon}+1
    \    ${VAresp_finalelementY}    Find_YLocation    //android.widget.ImageView[@resource-id="jp.naver.line.android:id/chathistory_row_thumbnail"][${looping}]
    \    Run Keyword If    ${VAresp_finalelementY}<${user_finalelementY}    Append To List    ${list_response}    ${looping}
    #${count_user_input}    Get Matching Xpath Count    //*[@resource-id="jp.naver.line.android:id/message_text" and contains (@text, "${user_input}")]
    #: FOR    ${looping}    IN RANGE    1    ${count_message1}+1
    #\    ${text}    Get Text    //android.widget.ListView/android.widget.LinearLayout[${looping}]
    #Run Keyword And Continue On Failure
    #${index_user_input}    Get Element Attribute    //android.widget.ListView[1]/android.widget.LinearLayout[contains (., "${user_input}")]    Index
    #${example_message}    Get Text    //*[@resource-id="jp.naver.line.android:id/message_text"][${count_texts}]
    #${next_response}    Get Text    //*[@resource-id="jp.naver.line.android:id/message_text" and contains (@text, "${user_input}")][${count_user_input}]/ancestor::android.widget.ListView/android.widget.LinearLayout/following-sibling::*[1]/descendant::*[@resource-id="jp.naver.line.android:id/message_text"]    #[contains(.,"${VA_Greet1}")]
    #${next2_response}    Get Text    //*[@resource-id="jp.naver.line.android:id/message_text" and contains (@text, "${user_input}")][${count_user_input}]/ancestor::android.widget.ListView/android.widget.LinearLayout/following-sibling::*[2]/descendant::*[@resource-id="jp.naver.line.android:id/message_text"]    #[contains(.,"${VA_Greet2}")]
    #${class_message}    Get Matching Xpath Count    //android.widget.ListView/android.widget.LinearLayout[1]/android.widget.LinearLayout/android.widget.RelativeLayout/android.view.View/android.widget.FrameLayout/child::*[@package="jp.naver.line.android"][1]
    #${class_message}    Get Matching Xpath Count    //android.widget.ListView[1]/android.widget.LinearLayout[1]/descendant::android.widget.FrameLayout/child::*[@package="jp.naver.line.android"]
    #${class_message12}    Get Matching Xpath Count    //android.widget.ListView[1]/android.widget.LinearLayout[2]/descendant::android.widget.FrameLayout/child::*[@package="jp.naver.line.android"]
    #${class_message1}    Get Matching Xpath Count    (//*[@resource-id="jp.naver.line.android:id/chathistory_row_message_layout"])[1]/child::*
    #${class_message2}    Get Matching Xpath Count    (//*[@resource-id="jp.naver.line.android:id/chathistory_row_message_layout"])[2]/child::*
    #@{webelements}    Get Webelements    //android.widget.ListView/android.widget.LinearLayout
    #${child_element1}    Get Element Attribute    //*[@resource-id="jp.naver.line.android:id/chathistory_row_message_layout"][1]/child::*    className
    #${child_element2}    Get Element Attribute    //*[@resource-id="jp.naver.line.android:id/chathistory_row_message_layout"][2]/child::*    className
    #${child_element1}    Get Element Attribute    //android.widget.ListView[1]/android.widget.LinearLayout[1]/descendant::android.widget.FrameLayout/child::*[@package="jp.naver.line.android"]    className
    #${child_element2}    Get Element Attribute    //android.widget.ListView[1]/android.widget.LinearLayout[2]/descendant::android.widget.FrameLayout/child::*[@package="jp.naver.line.android"]    className
    #Element Attribute Should Match    xpath=//android.widget.ListView/android.widget.LinearLayout[1]/android.widget.LinearLayout/android.widget.RelativeLayout/android.view.View/android.widget.FrameLayout/child::*[@package="jp.naver.line.android"]    class    android.widget.LinearLayout
    [Return]    @{list_response}
